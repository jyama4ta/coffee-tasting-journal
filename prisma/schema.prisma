// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "sqlite"
}

// ============================================
// 店舗マスター
// ============================================
model Shop {
  id         Int      @id @default(autoincrement())
  name       String // 店舗名（例: やなか珈琲）- 必須
  branchName String? // 支店名（例: 谷中店）- 任意
  address    String? // 住所
  url        String? // WebサイトURL
  notes      String? // メモ
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // リレーション
  coffeeBeans CoffeeBean[]

  @@map("shops")
}

// ============================================
// ドリッパーマスター
// ============================================
model Dripper {
  id           Int            @id @default(autoincrement())
  name         String // ドリッパー名（必須）
  manufacturer String? // メーカー
  size         EquipmentSize? // サイズ（01-04/その他）
  notes        String? // メモ
  url          String? // 商品ページURL
  imagePath    String? // 画像パス
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt

  // リレーション
  tastingEntries TastingEntry[]

  @@map("drippers")
}

// ============================================
// フィルターマスター
// ============================================
model Filter {
  id        Int            @id @default(autoincrement())
  name      String // フィルター名（必須）
  type      FilterType? // 種類（ペーパー/金属/布）
  size      EquipmentSize? // サイズ（01-04/その他）
  notes     String? // メモ
  url       String? // 商品ページURL
  imagePath String? // 画像パス
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt

  // リレーション
  tastingEntries TastingEntry[]

  @@map("filters")
}

// フィルター種類
enum FilterType {
  PAPER // ペーパー
  METAL // 金属
  CLOTH // 布
}

// ドリッパー・フィルターのサイズ
enum EquipmentSize {
  SIZE_01 // 01サイズ（1-2杯用）
  SIZE_02 // 02サイズ（1-4杯用）
  SIZE_03 // 03サイズ（3-6杯用）
  SIZE_04 // 04サイズ（4-8杯用）
  OTHER // その他・フリーサイズ
}

// ============================================
// 産地マスター（国を管理）
// ============================================
model OriginMaster {
  id        Int      @id @default(autoincrement())
  name      String   @unique // 国名（必須、ユニーク）例: エチオピア、コロンビア
  notes     String? // メモ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // リレーション
  beanMasters BeanMaster[]

  @@map("origin_masters")
}

// ============================================
// 銘柄マスター（同じ銘柄の購入記録を名寄せ）
// ============================================
model BeanMaster {
  id        Int      @id @default(autoincrement())
  name      String // 銘柄名（必須）
  notes     String? // 銘柄メモ
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // 外部キー
  originId Int?
  origin   OriginMaster? @relation(fields: [originId], references: [id], onDelete: SetNull)

  // リレーション
  coffeeBeans CoffeeBean[]

  // インデックス
  @@index([originId])
  @@map("bean_masters")
}

// ============================================
// コーヒー豆（購入記録）
// ============================================
model CoffeeBean {
  id              Int         @id @default(autoincrement())
  name            String // 銘柄（※将来的に削除予定、銘柄マスターから取得）
  origin          String? // 産地（※将来的に削除予定、銘柄マスターから取得）
  roastLevel      RoastLevel? // 焙煎度（8段階）- 購入時の実際の値
  process         Process? // 精製方法 - 購入時の実際の値
  isDecaf         Boolean     @default(false) // デカフェフラグ
  beanType        BeanType? // ブレンド/シングルオリジン
  acidityScore    Int         @default(0) // 酸味（0-5）
  bitternessScore Int         @default(0) // 苦味（0-5）
  bodyScore       Int         @default(0) // コク（0-5）
  flavorScore     Int         @default(0) // 風味（0-5）
  notes           String? // メモ（パッケージ説明など）
  url             String? // 商品ページURL
  purchaseDate    DateTime? // 購入日
  price           Int? // 価格（円）
  amount          Int? // 購入量（g）
  status          BeanStatus  @default(IN_STOCK) // ステータス
  finishedDate    DateTime? // 飲み切り日
  imagePath       String? // 画像パス
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // 外部キー
  shopId Int?
  shop   Shop? @relation(fields: [shopId], references: [id], onDelete: SetNull)

  beanMasterId Int?
  beanMaster   BeanMaster? @relation(fields: [beanMasterId], references: [id], onDelete: SetNull)

  // リレーション
  tastingEntries TastingEntry[]

  // インデックス
  @@index([status])
  @@index([shopId])
  @@index([beanMasterId])
  @@index([origin])
  @@index([roastLevel])
  @@map("coffee_beans")
}

// 焙煎度（8段階）
enum RoastLevel {
  LIGHT // ライトロースト → 浅煎り
  CINNAMON // シナモンロースト → 浅煎り
  MEDIUM // ミディアムロースト → 中浅煎り
  HIGH // ハイロースト・ダークロースト → 中煎り
  CITY // シティロースト → 中煎り
  FULL_CITY // フルシティロースト → 中深煎り
  FRENCH // フレンチロースト → 深煎り
  ITALIAN // イタリアンロースト → 深煎り
}

// 精製方法
enum Process {
  WASHED // ウォッシュド
  NATURAL // ナチュラル
  HONEY // ハニー
  PULPED_NATURAL // パルプドナチュラル
  SEMI_WASHED // セミウォッシュド
}

// 豆タイプ
enum BeanType {
  SINGLE_ORIGIN // シングルオリジン
  BLEND // ブレンド
}

// 豆ステータス
enum BeanStatus {
  IN_STOCK // 在庫中
  FINISHED // 飲み切り
}

// ============================================
// 試飲記録
// ============================================
model TastingEntry {
  id            Int      @id @default(autoincrement())
  grindSize     Float? // 挽き方（1.0-10.0、0.5刻み）
  brewDate      DateTime // 抽出日（必須）
  acidity       Int? // 酸味（1-5）
  bitterness    Int? // 苦味（1-5）
  sweetness     Int? // 甘味（1-5）
  body          Body? // ボディ
  aftertaste    Int? // 後味（1-5）
  flavorTags    String? // フレーバータグ（JSON配列として保存）
  overallRating Int? // 総合評価（1-5）
  notes         String? // テイスティングノート
  imagePath     String? // 画像パス
  brewedBy      String? // 淹れた人
  recordedBy    String? // 入力した人
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // 外部キー
  coffeeBeanId Int
  coffeeBean   CoffeeBean @relation(fields: [coffeeBeanId], references: [id], onDelete: Cascade)

  dripperId Int?
  dripper   Dripper? @relation(fields: [dripperId], references: [id], onDelete: SetNull)

  filterId Int?
  filter   Filter? @relation(fields: [filterId], references: [id], onDelete: SetNull)

  // リレーション
  tastingNotes TastingNote[]

  // インデックス
  @@index([coffeeBeanId])
  @@index([brewDate])
  @@index([overallRating])
  @@map("tasting_entries")
}

// ============================================
// テイスティングノート（1つの試飲記録に対して複数人が記録可能）
// ============================================
model TastingNote {
  id            Int      @id @default(autoincrement())
  recordedBy    String? // 記録者名
  acidity       Int? // 酸味（1-5）
  bitterness    Int? // 苦味（1-5）
  sweetness     Int? // 甘味（1-5）
  body          Body? // ボディ
  aftertaste    Int? // 後味（1-5）
  flavorTags    String? // フレーバータグ（JSON配列として保存）
  overallRating Int? // 総合評価（1-5）
  notes         String? // テイスティングノート
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // 外部キー
  tastingEntryId Int
  tastingEntry   TastingEntry @relation(fields: [tastingEntryId], references: [id], onDelete: Cascade)

  // インデックス
  @@index([tastingEntryId])
  @@map("tasting_notes")
}

// ボディ
enum Body {
  LIGHT // 軽い
  MEDIUM // 中程度
  HEAVY // 重い
}
