# Coffee Tasting Journal - Copilot Instructions

## 最重要ルール（必ず守ること）

### 1. TDD（テスト駆動開発）を必ず実践

**新機能・コンポーネント実装時は必ず以下の順序で行うこと:**

```
1. Red:      テストを先に書く → テストが失敗することを確認
2. Green:    最小限の実装でテストを通す
3. Refactor: コードを改善（テストは通ったまま）
```

**禁止事項:**

```
❌ 実装してからテストを書く
❌ テストを書かずに実装を完了する
```

**必須フロー:**

```
✅ テストファイル作成 → テスト失敗確認 → 実装 → テスト成功確認
```

### 2. コミット前の全テスト実行（絶対厳守）

**コミット操作を行う前に、必ず以下のテストを全て実行し、成功を確認すること:**

```bash
# 1. ユニットテスト（Vitest）
npm test

# 2. E2Eテスト（Playwright）
npx playwright test
```

**禁止事項:**

```
❌ テストを実行せずにコミットする
❌ テストが失敗している状態でコミットする
❌ 「ローカル環境でPlaywrightが動かない」を理由にE2Eテストをスキップする
❌ 一部のテストのみ実行してコミットする
```

**必須フロー:**

```
✅ npm test → 全テスト成功を確認
✅ npx playwright test → 全テスト成功を確認
✅ 両方成功した場合のみ git commit を実行
```

**テスト失敗時:**

```
1. コミットを中断
2. 失敗の原因を特定（実装の問題 or テストの問題）
3. 原因に応じて実装またはテストを修正
4. 再度全テストを実行
5. 全テスト成功を確認してからコミット
```

### 3. 日本語での対応

- すべての回答・コメント・ドキュメントは**日本語**で記述
- コミットメッセージも日本語

### 4. ドキュメント同期

- コード変更時は `/docs` 配下の関連ドキュメントも更新
- 特に `test-specification.md` はテスト追加時に必ず更新

### 5. テストファイルの保護

**禁止事項:**

```
❌ テストファイル（*.test.ts, *.test.tsx）を削除する
❌ テストケースを削除してテストを通す
```

### 6. Git操作の制限

**禁止事項:**

```
❌ git commit --amend を使用する
❌ git rebase を使用する
❌ git push --force を使用する
```

**理由:**

- コミット履歴の改変はチーム開発で問題を引き起こす
- 修正が必要な場合は新しいコミットを作成すること

## 詳細仕様（別ファイル参照）

| ファイル                                                                | 内容                         |
| ----------------------------------------------------------------------- | ---------------------------- |
| [data-model.instructions.md](instructions/data-model.instructions.md)   | データモデル定義             |
| [development.instructions.md](instructions/development.instructions.md) | 開発ガイドライン・TDD詳細    |
| [tech-stack.instructions.md](instructions/tech-stack.instructions.md)   | 技術スタック・アーキテクチャ |

## プロジェクト概要

自宅でハンドドリップしたコーヒーの試飲記録を管理するWebアプリケーション。
産地・銘柄・焙煎具合・挽き方を記録し、味の感想を評価できる。

- **技術スタック**: Next.js (App Router) + TypeScript + SQLite + Prisma
- **運用環境**: 家庭内Docker/Kubernetes環境
- **利用者**: 2〜3人での同時利用を想定
