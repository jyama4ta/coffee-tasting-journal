# 開発ガイドライン

このファイルはCoffee Tasting Journalの開発ルールを定義します。

## TDD（テスト駆動開発）- 最重要

### 必ず守ること

**新機能・コンポーネント実装時は必ず以下の順序で行う:**

```
1. Red:      テストを先に書く → テストが失敗することを確認
2. Green:   最小限の実装でテストを通す
3. Refactor: コードを改善（テストは通ったまま）
```

### t_wadaの原則を厳守

- **テストコードは最初に書く**（Red → Green → Refactor）
- **テストしやすい設計を優先**
- **テストの可読性を重視**（テストコードも製品コード）
- **適切な粒度でのテスト分割**

### 実装フロー例（UIコンポーネント）

```
1. テストファイルを作成: src/__tests__/components/MyComponent.test.tsx
2. テストケースを定義（レンダリング、インタラクション、境界値等）
3. テスト実行 → 失敗を確認（Red）
4. コンポーネントを実装: src/components/MyComponent.tsx
5. テスト実行 → 成功を確認（Green）
6. リファクタリング（テストは通ったまま）
7. テスト仕様書を更新: docs/test-specification.md
```

### 実装フロー例（API）

```
1. テストファイルを作成: src/__tests__/api/resource.test.ts
2. テストケースを定義（CRUD、バリデーション、エラーハンドリング等）
3. テスト実行 → 失敗を確認（Red）
4. APIを実装: src/app/api/resource/route.ts
5. テスト実行 → 成功を確認（Green）
6. リファクタリング
7. API仕様書・テスト仕様書を更新
```

## コミュニケーション

### 言語

- **すべての回答・コメント・ドキュメントは日本語で記述すること**

### コミットメッセージ

日本語で記載し、それまでの作業内容を説明すること:

```
1行目: 変更の概要（50文字程度）
空行
3行目以降: 変更の詳細（何を、なぜ、どのように変更したか）
```

例:

```
豆マスターのCRUD APIを実装

- GET /api/beans: 豆一覧取得（ステータスでのフィルタリング対応）
- POST /api/beans: 新規豆登録（バリデーション付き）
- GET /api/beans/[id]: 豆詳細取得（関連する試飲記録も含む）
- PUT /api/beans/[id]: 豆情報更新
- DELETE /api/beans/[id]: 豆削除（関連する試飲記録も削除）

Prisma Clientを使用してタイプセーフなDB操作を実現。
```

## ターミナル操作

- **作業ディレクトリ**: プロジェクトルートから移動しないこと（`cd` 禁止）
- **パス指定**: すべて相対パスで指定すること
- **操作範囲**: プロジェクトルート配下のみ操作可能
- **エラー発生時の対応**:
  1. コマンドが失敗した場合、まず原因を分析する
  2. 原因と、それを踏まえた次のコマンドについて説明する
  3. ユーザーの許可を得てから次のコマンドを実行する

## ドキュメント管理

### 配置場所

`/docs` フォルダ配下で一元管理

### 構成

| ファイル                | 内容                                                      |
| ----------------------- | --------------------------------------------------------- |
| `PROGRESS.md`           | 開発進捗メモ（完了した作業、TODO、技術的課題）            |
| `api-specification.md`  | API仕様書（エンドポイント、データモデル、バリデーション） |
| `test-specification.md` | テスト仕様書（テストケース一覧、テスト設計方針）          |
| `data-model.md`         | ER図とエンティティ詳細                                    |
| `state-diagram.md`      | 状態遷移図とバリデーションルール                          |
| `architecture.md`       | システムアーキテクチャ設計                                |

### 同期更新ルール

- **ソースコード修正時は関連ドキュメントも必ず更新すること**
- 新規API実装時は`api-specification.md`にエンドポイント仕様を追加
- テスト作成時は`test-specification.md`にテストケース一覧を追加
- 機能完了時は`PROGRESS.md`の完了作業に記録

## 設計プロセス

- **データモデル設計**: 実装前に必ず状態遷移図を作成し、データモデルを明確化すること
- コーディングは状態遷移図のレビュー完了後に開始
- データの整合性とライフサイクルを事前に検証

## 実装優先順位

1. **CRUD機能**: 試飲記録の作成・表示・編集・削除
2. **フィルタリング・検索**: 産地、焙煎度、評価などでの絞り込み
3. **シンプルなUI**: 記録の入力と一覧表示に最適化
4. **データ永続化**: Dockerボリュームまたは外部ストレージでのデータ保持
5. **入力支援**: 産地・銘柄の入力時に過去の入力履歴からオートコンプリート表示
