# テスト仕様書

## 概要

Coffee Tasting Journalのテスト仕様書です。TDD（テスト駆動開発）の原則に従い、実装前にテストを作成しています。

## テスト環境

- **テストフレームワーク**: Vitest 4.x
- **テストライブラリ**: @testing-library/react（UIテスト用）
- **データベース**: SQLite（テストでも本番と同じDBを使用、各テスト前後でクリーンアップ）

## テスト実行方法

```bash
# 全テスト実行
npm test

# 特定ファイルのテスト実行
npm test -- src/__tests__/api/shops.test.ts

# ウォッチモードで実行（ファイル変更時に自動実行）
npm test

# 単発実行（CIモード）
npm test -- --run
```

---

## Shop API テスト

**ファイル:** `src/__tests__/api/shops.test.ts`

### テストケース一覧

| #   | カテゴリ               | テストケース                                     | 期待結果                                 |
| --- | ---------------------- | ------------------------------------------------ | ---------------------------------------- |
| 1   | GET /api/shops         | 空の配列を返す（店舗が存在しない場合）           | 200 + `[]`                               |
| 2   | GET /api/shops         | 全ての店舗を返す                                 | 200 + 店舗配列                           |
| 3   | POST /api/shops        | 新しい店舗を作成する                             | 201 + 作成データ                         |
| 4   | POST /api/shops        | 店舗名のみで作成できる（任意フィールドは省略可） | 201 + 作成データ（任意フィールドはnull） |
| 5   | POST /api/shops        | 店舗名が空の場合は400エラー                      | 400 + エラーメッセージ                   |
| 6   | POST /api/shops        | 店舗名がない場合は400エラー                      | 400 + エラーメッセージ                   |
| 7   | GET /api/shops/[id]    | 指定したIDの店舗を返す                           | 200 + 店舗データ                         |
| 8   | GET /api/shops/[id]    | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ                   |
| 9   | GET /api/shops/[id]    | 無効なIDの場合は400エラー                        | 400 + エラーメッセージ                   |
| 10  | PUT /api/shops/[id]    | 店舗を更新する                                   | 200 + 更新データ                         |
| 11  | PUT /api/shops/[id]    | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ                   |
| 12  | PUT /api/shops/[id]    | 名前を空に更新しようとすると400エラー            | 400 + エラーメッセージ                   |
| 13  | DELETE /api/shops/[id] | 店舗を削除する                                   | 204 + DBから削除確認                     |
| 14  | DELETE /api/shops/[id] | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ                   |
| 15  | 店舗名と支店名         | 店舗名と支店名を分けて登録できる                 | 201 + name, branchName含む               |
| 16  | 店舗名と支店名         | 店舗名のみでも登録できる（支店名なし）           | 201 + name含む、branchName=null          |
| 17  | 店舗名と支店名         | 店舗名が空の場合は400エラー                      | 400 + エラーメッセージ                   |
| 18  | 店舗名と支店名         | displayNameに店舗名と支店名が結合して含まれる    | 200 + displayName="店舗名 支店名"        |
| 19  | 店舗名と支店名         | 店舗名のみの場合displayNameは店舗名のみ          | 200 + displayName=店舗名                 |
| 20  | 店舗名と支店名         | 一覧取得時もdisplayNameが含まれる                | 200 + 全件にdisplayName含む              |

### テスト設計方針

1. **正常系**: 基本的なCRUD操作が正しく動作すること
2. **異常系（バリデーション）**: 不正な入力に対して適切なエラーを返すこと
3. **異常系（存在しないリソース）**: 存在しないIDへのアクセスで404を返すこと
4. **境界値**: 空文字、null、必須フィールドの欠落をテスト
5. **店舗名/支店名**: 店舗名と支店名の組み合わせパターン、displayName生成ロジック

### テストデータ管理

```typescript
// 各テスト前にDBをクリーンアップ
beforeEach(async () => {
  await prisma.shop.deleteMany();
});

// テスト後もクリーンアップ
afterEach(async () => {
  await prisma.shop.deleteMany();
});
```

---

## Dripper API テスト

**ファイル:** `src/__tests__/api/drippers.test.ts`

### テストケース一覧

| #   | カテゴリ                  | テストケース                                           | 期待結果                                 |
| --- | ------------------------- | ------------------------------------------------------ | ---------------------------------------- |
| 1   | GET /api/drippers         | 空の配列を返す（ドリッパーが存在しない場合）           | 200 + `[]`                               |
| 2   | GET /api/drippers         | 全てのドリッパーを返す                                 | 200 + ドリッパー配列                     |
| 3   | POST /api/drippers        | 新しいドリッパーを作成する                             | 201 + 作成データ                         |
| 4   | POST /api/drippers        | ドリッパー名のみで作成できる（任意フィールドは省略可） | 201 + 作成データ（任意フィールドはnull） |
| 5   | POST /api/drippers        | ドリッパー名が空の場合は400エラー                      | 400 + エラーメッセージ                   |
| 6   | POST /api/drippers        | ドリッパー名がない場合は400エラー                      | 400 + エラーメッセージ                   |
| 7   | GET /api/drippers/[id]    | 指定したIDのドリッパーを返す                           | 200 + ドリッパーデータ                   |
| 8   | GET /api/drippers/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                   |
| 9   | GET /api/drippers/[id]    | 無効なIDの場合は400エラー                              | 400 + エラーメッセージ                   |
| 10  | PUT /api/drippers/[id]    | ドリッパーを更新する                                   | 200 + 更新データ                         |
| 11  | PUT /api/drippers/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                   |
| 12  | PUT /api/drippers/[id]    | 名前を空に更新しようとすると400エラー                  | 400 + エラーメッセージ                   |
| 13  | DELETE /api/drippers/[id] | ドリッパーを削除する                                   | 204 + DBから削除確認                     |
| 14  | DELETE /api/drippers/[id] | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                   |
| 15  | POST /api/drippers        | URLを指定してドリッパーを作成できる                    | 201 + url含む                            |
| 16  | POST /api/drippers        | サイズを指定してドリッパーを作成できる                 | 201 + size含む（SIZE_01〜04, OTHER）     |
| 17  | POST /api/drippers        | サイズなしでも作成できる（任意フィールド）             | 201 + size=null                          |
| 18  | POST /api/drippers        | 無効なサイズ値は400エラー                              | 400 + エラーメッセージ                   |
| 19  | PUT /api/drippers/[id]    | サイズを更新できる                                     | 200 + 更新されたsize                     |
| 20  | POST /api/drippers        | 全サイズ値（SIZE_01〜04, OTHER）を登録・取得できる     | 201 + 各サイズ値                         |

### テスト設計方針

ShopAPIテストと同様の設計方針を適用。

---

## Filter API テスト

**ファイル:** `src/__tests__/api/filters.test.ts`

### テストケース一覧

| #   | カテゴリ                 | テストケース                                           | 期待結果                                    |
| --- | ------------------------ | ------------------------------------------------------ | ------------------------------------------- |
| 1   | GET /api/filters         | 空の配列を返す（フィルターが存在しない場合）           | 200 + `[]`                                  |
| 2   | GET /api/filters         | 全てのフィルターを返す                                 | 200 + フィルター配列                        |
| 3   | POST /api/filters        | 新しいフィルターを作成する                             | 201 + 作成データ                            |
| 4   | POST /api/filters        | フィルター名のみで作成できる（任意フィールドは省略可） | 201 + 作成データ（任意フィールドはnull）    |
| 5   | POST /api/filters        | フィルター種類（type）を指定して作成できる             | 201 + 作成データ（typeがPAPER/METAL/CLOTH） |
| 6   | POST /api/filters        | フィルター名が空の場合は400エラー                      | 400 + エラーメッセージ                      |
| 7   | POST /api/filters        | フィルター名がない場合は400エラー                      | 400 + エラーメッセージ                      |
| 8   | POST /api/filters        | 無効なフィルター種類の場合は400エラー                  | 400 + エラーメッセージ                      |
| 9   | GET /api/filters/[id]    | 指定したIDのフィルターを返す                           | 200 + フィルターデータ                      |
| 10  | GET /api/filters/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                      |
| 11  | GET /api/filters/[id]    | 無効なIDの場合は400エラー                              | 400 + エラーメッセージ                      |
| 12  | PUT /api/filters/[id]    | フィルターを更新する                                   | 200 + 更新データ                            |
| 13  | PUT /api/filters/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                      |
| 14  | PUT /api/filters/[id]    | 名前を空に更新しようとすると400エラー                  | 400 + エラーメッセージ                      |
| 15  | DELETE /api/filters/[id] | フィルターを削除する                                   | 204 + DBから削除確認                        |
| 16  | DELETE /api/filters/[id] | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ                      |
| 17  | POST /api/filters        | URLを指定してフィルターを作成できる                    | 201 + url含む                               |
| 18  | POST /api/filters        | サイズを指定してフィルターを作成できる                 | 201 + size含む（SIZE_01〜04, OTHER）        |
| 19  | POST /api/filters        | サイズなしでも作成できる（任意フィールド）             | 201 + size=null                             |
| 20  | POST /api/filters        | 無効なサイズ値は400エラー                              | 400 + エラーメッセージ                      |
| 21  | PUT /api/filters/[id]    | サイズを更新できる                                     | 200 + 更新されたsize                        |
| 22  | POST /api/filters        | 全サイズ値（SIZE_01〜04, OTHER）を登録・取得できる     | 201 + 各サイズ値                            |

### テスト設計方針

ShopAPIテストと同様の設計方針を適用。FilterType（PAPER/METAL/CLOTH）、EquipmentSize（SIZE_01〜04, OTHER）のバリデーションテストを追加。

---

## CoffeeBean API テスト

**ファイル:** `src/__tests__/api/beans.test.ts`

### テストケース一覧

| #   | カテゴリ               | テストケース                                   | 期待結果                                  |
| --- | ---------------------- | ---------------------------------------------- | ----------------------------------------- |
| 1   | GET /api/beans         | 空の配列を返す（豆が存在しない場合）           | 200 + `[]`                                |
| 2   | GET /api/beans         | 全ての豆を返す                                 | 200 + 豆配列                              |
| 3   | GET /api/beans         | ステータスでフィルタリングできる（在庫中のみ） | 200 + フィルタリングされた配列            |
| 4   | GET /api/beans         | 関連する店舗情報を含めて返す                   | 200 + shop含む                            |
| 5   | POST /api/beans        | 新しい豆を作成する                             | 201 + 作成データ                          |
| 6   | POST /api/beans        | 豆名のみで作成できる（任意フィールドは省略可） | 201 + 作成データ                          |
| 7   | POST /api/beans        | 店舗を紐づけて作成できる                       | 201 + shopId含む                          |
| 8   | POST /api/beans        | 豆名が空の場合は400エラー                      | 400 + エラーメッセージ                    |
| 9   | POST /api/beans        | 豆名がない場合は400エラー                      | 400 + エラーメッセージ                    |
| 10  | POST /api/beans        | 無効な焙煎度の場合は400エラー                  | 400 + エラーメッセージ                    |
| 11  | POST /api/beans        | 無効な精製方法の場合は400エラー                | 400 + エラーメッセージ                    |
| 12  | POST /api/beans        | 存在しない店舗IDの場合は400エラー              | 400 + エラーメッセージ                    |
| 13  | GET /api/beans/[id]    | 指定したIDの豆を返す（関連する試飲記録も含む） | 200 + tastingEntries含む                  |
| 14  | GET /api/beans/[id]    | 存在しないIDの場合は404エラー                  | 404 + エラーメッセージ                    |
| 15  | GET /api/beans/[id]    | 無効なIDの場合は400エラー                      | 400 + エラーメッセージ                    |
| 16  | PUT /api/beans/[id]    | 豆を更新する                                   | 200 + 更新データ                          |
| 17  | PUT /api/beans/[id]    | 存在しないIDの場合は404エラー                  | 404 + エラーメッセージ                    |
| 18  | PUT /api/beans/[id]    | 名前を空に更新しようとすると400エラー          | 400 + エラーメッセージ                    |
| 19  | PATCH /api/beans/[id]  | ステータスを在庫中から飲み切りに変更できる     | 200 + status=FINISHED + finishedDate設定  |
| 20  | PATCH /api/beans/[id]  | ステータスを飲み切りから在庫中に戻せる         | 200 + status=IN_STOCK + finishedDate=null |
| 21  | PATCH /api/beans/[id]  | 存在しないIDの場合は404エラー                  | 404 + エラーメッセージ                    |
| 22  | PATCH /api/beans/[id]  | 無効なステータスの場合は400エラー              | 400 + エラーメッセージ                    |
| 23  | DELETE /api/beans/[id] | 豆を削除する（関連する試飲記録も削除）         | 204 + DBから削除確認                      |
| 24  | DELETE /api/beans/[id] | 存在しないIDの場合は404エラー                  | 404 + エラーメッセージ                    |
| 25  | POST /api/beans        | 酸味・苦味・コク・風味の評価を保存できる       | 201 + 評価スコア含む（0-5）               |
| 26  | POST /api/beans        | 評価未指定の場合は0で保存される                | 201 + スコア0                             |
| 27  | POST /api/beans        | 評価が範囲外（6以上）の場合は400エラー         | 400 + エラーメッセージ                    |
| 28  | POST /api/beans        | 評価が範囲外（負数）の場合は400エラー          | 400 + エラーメッセージ                    |

### テスト設計方針

ShopAPIテストと同様の設計方針を適用。以下の追加テストを含む:

- RoastLevel（8段階）、Process（5種類）のバリデーションテスト
- ステータス変更（PATCH）時のfinishedDate自動設定/クリアのテスト
- 関連エンティティ（shop, tastingEntries）のincludeテスト
- 評価スコア（acidityScore, bitternessScore, bodyScore, flavorScore）のバリデーションテスト（0-5の範囲チェック）

---

## TastingEntry API テスト

**ファイル:** `src/__tests__/api/tastings.test.ts`

### テストケース一覧

| #   | カテゴリ                  | テストケース                                           | 期待結果                       |
| --- | ------------------------- | ------------------------------------------------------ | ------------------------------ |
| 1   | GET /api/tastings         | 空の配列を返す（試飲記録が存在しない場合）             | 200 + `[]`                     |
| 2   | GET /api/tastings         | 全ての試飲記録を返す                                   | 200 + 試飲記録配列             |
| 3   | GET /api/tastings         | 豆IDでフィルタリングできる                             | 200 + フィルタリングされた配列 |
| 4   | GET /api/tastings         | 関連する豆・ドリッパー・フィルター情報を含めて返す     | 200 + 関連情報含む             |
| 5   | POST /api/tastings        | 新しい試飲記録を作成する                               | 201 + 作成データ               |
| 6   | POST /api/tastings        | 豆IDと抽出日のみで作成できる（任意フィールドは省略可） | 201 + 作成データ               |
| 7   | POST /api/tastings        | 評価値（酸味、苦味など）を設定できる                   | 201 + 評価値含む               |
| 8   | POST /api/tastings        | フレーバータグを複数設定できる                         | 201 + flavorTags含む           |
| 9   | POST /api/tastings        | ドリッパーとフィルターを紐づけて作成できる             | 201 + dripperId, filterId含む  |
| 10  | POST /api/tastings        | 豆IDがない場合は400エラー                              | 400 + エラーメッセージ         |
| 11  | POST /api/tastings        | 抽出日がない場合は400エラー                            | 400 + エラーメッセージ         |
| 12  | POST /api/tastings        | 存在しない豆IDの場合は400エラー                        | 400 + エラーメッセージ         |
| 13  | POST /api/tastings        | 飲み切りステータスの豆は選択不可（400エラー）          | 400 + 「在庫中」メッセージ     |
| 14  | POST /api/tastings        | 無効なボディ値の場合は400エラー                        | 400 + エラーメッセージ         |
| 15  | POST /api/tastings        | 評価値が範囲外の場合は400エラー（1-10）                | 400 + エラーメッセージ         |
| 16  | POST /api/tastings        | 総合評価が範囲外の場合は400エラー（1-5）               | 400 + エラーメッセージ         |
| 17  | GET /api/tastings/[id]    | 指定したIDの試飲記録を返す                             | 200 + 試飲記録データ           |
| 18  | GET /api/tastings/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ         |
| 19  | GET /api/tastings/[id]    | 無効なIDの場合は400エラー                              | 400 + エラーメッセージ         |
| 20  | PUT /api/tastings/[id]    | 試飲記録を更新する                                     | 200 + 更新データ               |
| 21  | PUT /api/tastings/[id]    | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ         |
| 22  | PUT /api/tastings/[id]    | 評価値が範囲外の場合は400エラー                        | 400 + エラーメッセージ         |
| 23  | DELETE /api/tastings/[id] | 試飲記録を削除する                                     | 204 + DBから削除確認           |
| 24  | DELETE /api/tastings/[id] | 存在しないIDの場合は404エラー                          | 404 + エラーメッセージ         |
| 25  | flavorTags エッジケース   | flavorTagsが空配列の場合、空のJSON配列文字列として保存 | 201 + flavorTags="[]"          |
| 26  | flavorTags エッジケース   | flavorTagsが未指定の場合、nullとして保存               | 201 + flavorTags=null          |
| 27  | flavorTags エッジケース   | flavorTagsがnullの場合も正常に保存される               | 201 + flavorTags=null          |
| 28  | flavorTags エッジケース   | 空配列文字列のflavorTagsでもGETで正常に取得できる      | 200 + flavorTags="[]"          |
| 29  | flavorTags エッジケース   | nullのflavorTagsでもGETで正常に取得できる              | 200 + flavorTags=null          |

### テスト設計方針

ShopAPIテストと同様の設計方針を適用。以下の追加テストを含む:

- **豆ステータス制約**: 在庫中（IN_STOCK）の豆のみ試飲記録を作成可能
- **評価値バリデーション**: 酸味・苦味・甘味・後味は1-10、総合評価は1-5の範囲
- **Body値バリデーション**: LIGHT/MEDIUM/HEAVYのいずれか
- **フレーバータグ**: 配列で受け取りJSON文字列として保存
- **フレーバータグ エッジケース**: null、空配列、空文字列のハンドリング
- **関連エンティティ**: coffeeBean, dripper, filterのincludeテスト

---

## テストカバレッジ目標

| 領域               | 目標カバレッジ |
| ------------------ | -------------- |
| API Routes         | 90%以上        |
| ユーティリティ関数 | 80%以上        |
| UIコンポーネント   | 70%以上        |

---

## Button コンポーネントテスト

**ファイル:** `src/__tests__/components/Button.test.tsx`

### テストケース一覧

| #   | カテゴリ         | テストケース                                             | 期待結果                                   |
| --- | ---------------- | -------------------------------------------------------- | ------------------------------------------ |
| 1   | レンダリング     | 子要素を正しくレンダリングする                           | テキストが表示される                       |
| 2   | レンダリング     | button要素としてレンダリングされる（hrefなしの場合）     | button要素が存在                           |
| 3   | レンダリング     | Link要素としてレンダリングされる（hrefありの場合）       | link要素にhref属性あり                     |
| 4   | variant スタイル | primary variant - amber背景・白文字のスタイルを適用する  | bg-amber-600, text-white                   |
| 5   | variant スタイル | secondary variant - gray背景・白文字のスタイルを適用する | bg-gray-600, text-white                    |
| 6   | variant スタイル | danger variant - red背景・白文字のスタイルを適用する     | bg-red-600, text-white                     |
| 7   | variant スタイル | outline variant - 白背景・amber文字・amber枠線           | bg-white, text-amber-600, border-amber-600 |
| 8   | variant スタイル | outline-light variant - 透明背景・白文字・白枠線         | bg-transparent, text-white, border-white   |
| 9   | variant スタイル | デフォルトはprimary variantが適用される                  | bg-amber-600                               |
| 10  | size スタイル    | sm size - 小さいパディングを適用する                     | px-3, py-1.5, text-sm                      |
| 11  | size スタイル    | md size - 中程度のパディングを適用する                   | px-4, py-2, text-base                      |
| 12  | size スタイル    | lg size - 大きいパディングを適用する                     | px-6, py-3, text-lg                        |
| 13  | size スタイル    | デフォルトはmd sizeが適用される                          | px-4, py-2                                 |
| 14  | インタラクション | クリック時にonClickハンドラが呼ばれる                    | ハンドラが1回呼ばれる                      |
| 15  | インタラクション | disabled時はクリックしても反応しない                     | ハンドラ未呼出、disabled属性あり           |
| 16  | 属性             | type属性を指定できる                                     | type="submit"                              |
| 17  | 属性             | デフォルトのtype属性はbutton                             | type="button"                              |
| 18  | 属性             | 追加のclassNameを適用できる                              | カスタムクラスが含まれる                   |

---

## Card コンポーネントテスト

**ファイル:** `src/__tests__/components/Card.test.tsx`

### テストケース一覧

| #   | カテゴリ     | テストケース                            | 期待結果                 |
| --- | ------------ | --------------------------------------- | ------------------------ |
| 1   | レンダリング | リンクが正しいhrefを持つ                | href属性が指定値         |
| 2   | レンダリング | アイコンが表示される                    | アイコン文字が表示       |
| 3   | レンダリング | タイトルが表示される                    | タイトルテキストが表示   |
| 4   | レンダリング | 説明が表示される                        | 説明テキストが表示       |
| 5   | count        | countが指定された場合バッジが表示される | 数値がバッジとして表示   |
| 6   | count        | countが0の場合もバッジが表示される      | 0がバッジとして表示      |
| 7   | count        | countが未指定の場合バッジが表示されない | バッジ要素なし           |
| 8   | color        | デフォルトカラー（bg-amber-50）が適用   | bg-amber-50クラスあり    |
| 9   | color        | カスタムカラーが適用される              | 指定したカラークラスあり |
| 10  | スタイル     | カードに必要な基本スタイルが適用される  | rounded-lg, shadow-md等  |

---

## StarRating コンポーネントテスト

**ファイル:** `src/__tests__/components/StarRating.test.tsx`

### テストケース一覧

| #   | カテゴリ         | テストケース                                      | 期待結果                 |
| --- | ---------------- | ------------------------------------------------- | ------------------------ |
| 1   | レンダリング     | ラベルが正しく表示される                          | ラベルテキスト表示       |
| 2   | レンダリング     | 5つの星アイコンが表示される                       | 5つの星要素              |
| 3   | レンダリング     | 星アイコンで表示される（デフォルト）              | ★（星）表示              |
| 4   | レンダリング     | 豆アイコンで表示される（icon="bean"指定時）       | 🫘（豆）表示             |
| 5   | 値の表示         | 指定した値の数だけ星が塗りつぶされる              | 塗りつぶし星数が一致     |
| 6   | 値の表示         | value=0の場合、塗りつぶされた星は0個              | すべて未塗りつぶし       |
| 7   | 値の表示         | value=5の場合、全ての星が塗りつぶされる           | すべて塗りつぶし         |
| 8   | minValue=0       | minValue=0の場合、value=0でも正常に表示される     | 0個の塗りつぶし          |
| 9   | minValue=0       | minValue=0の場合、最初の星をクリックすると0になる | onChange(0)              |
| 10  | minValue=0       | minValue=0の場合、ArrowLeftキーで0まで下げられる  | onChange(0)              |
| 11  | minValue=0       | minValue=0の場合、hidden inputに"0"が設定される   | value="0"                |
| 12  | インタラクション | 星をクリックすると値が変わる                      | onChange(クリック位置)   |
| 13  | インタラクション | 選択済みの星をクリックするとnull/0になる          | onChange(null or 0)      |
| 14  | キーボード操作   | ArrowRightで値が増加する                          | onChange(現在値+1)       |
| 15  | キーボード操作   | ArrowLeftで値が減少する                           | onChange(現在値-1)       |
| 16  | キーボード操作   | Enterキーでフォーカス中の星を選択                 | onChange(フォーカス位置) |
| 17  | フォーム連携     | hidden inputにname属性が設定される                | name属性あり             |
| 18  | フォーム連携     | hidden inputに現在の値が設定される                | value="3"など            |
| 19  | フォーム連携     | 値がnullの場合、hidden inputの値は空文字          | value=""                 |
| 20  | アクセシビリティ | role="radiogroup"が設定される                     | radiogroup role          |
| 21  | アクセシビリティ | 各星にrole="radio"が設定される                    | radio role               |
| 22  | アクセシビリティ | キーボードでフォーカス・選択可能                  | tabindex, keydown対応    |

### 設計ポイント

- **アイコン切り替え**: `icon="star"`（デフォルト）または`icon="bean"`で表示アイコンを切り替え
- **minValue対応**: `minValue={0}`で0〜5の6段階評価、`minValue={1}`（デフォルト）で1〜5の5段階評価
- **フォーム連携**: hidden inputで値を送信
- **アクセシビリティ**: キーボード操作（矢印キー、Enter、Space）に対応

---

## Navigation コンポーネントテスト

**ファイル:** `src/__tests__/components/Navigation.test.tsx`

### テストケース一覧

| #   | カテゴリ                       | テストケース                                               | 期待結果                         |
| --- | ------------------------------ | ---------------------------------------------------------- | -------------------------------- |
| 1   | レンダリング                   | ロゴが表示される                                           | ロゴテキスト表示                 |
| 2   | レンダリング                   | 全てのナビゲーションリンクが表示される                     | 6項目すべて表示                  |
| 3   | レンダリング                   | ロゴがホームへのリンクを持つ                               | href="/"                         |
| 4   | リンク                         | 各リンクが正しいhrefを持つ                                 | 各ページへのhref                 |
| 5   | アクティブ状態                 | ホームページでホームリンクがアクティブ                     | bg-amber-800クラスあり           |
| 6   | アクティブ状態                 | 試飲記録ページで試飲記録リンクがアクティブ                 | bg-amber-800クラスあり           |
| 7   | アクティブ状態                 | サブページでも親ページがアクティブになる                   | /tastings/newで試飲記録有効      |
| 8   | アクティブ状態                 | 非アクティブなリンクはアクティブスタイルなし               | text-amber-100、bg-amber-800なし |
| 9   | モバイルメニュー               | ハンバーガーメニューボタンが表示される                     | ボタン要素存在                   |
| 10  | モバイルメニュー               | 初期状態ではモバイルメニューが閉じている                   | mobile-menu非表示                |
| 11  | モバイルメニュー               | ハンバーガーボタンをクリックするとモバイルメニューが開く   | mobile-menu表示                  |
| 12  | モバイルメニュー               | モバイルメニューに全てのナビゲーションリンクが表示される   | 6項目すべて表示                  |
| 13  | モバイルメニュー               | モバイルメニューが開いている時に再度ボタンをクリックで閉じ | mobile-menu非表示                |
| 14  | モバイルメニュー               | モバイルメニュー内のリンクをクリックするとメニューが閉じる | mobile-menu非表示                |
| 15  | デスクトップメニューのクリック | ホームリンクをクリックできる                               | クリック成功                     |
| 16  | デスクトップメニューのクリック | 試飲記録リンクをクリックできる                             | クリック成功                     |
| 17  | デスクトップメニューのクリック | 豆リンクをクリックできる                                   | クリック成功                     |
| 18  | デスクトップメニューのクリック | 店舗リンクをクリックできる                                 | クリック成功                     |
| 19  | デスクトップメニューのクリック | ドリッパーリンクをクリックできる                           | クリック成功                     |
| 20  | デスクトップメニューのクリック | フィルターリンクをクリックできる                           | クリック成功                     |
| 21  | モバイルメニューのクリック     | ホームリンクをクリックするとメニューが閉じる               | mobile-menu非表示                |
| 22  | モバイルメニューのクリック     | 試飲記録リンクをクリックするとメニューが閉じる             | mobile-menu非表示                |
| 23  | モバイルメニューのクリック     | 豆リンクをクリックするとメニューが閉じる                   | mobile-menu非表示                |
| 24  | モバイルメニューのクリック     | 店舗リンクをクリックするとメニューが閉じる                 | mobile-menu非表示                |
| 25  | モバイルメニューのクリック     | ドリッパーリンクをクリックするとメニューが閉じる           | mobile-menu非表示                |
| 26  | モバイルメニューのクリック     | フィルターリンクをクリックするとメニューが閉じる           | mobile-menu非表示                |

---

## GrindSizeSlider コンポーネントテスト

**ファイル:** `src/__tests__/components/GrindSizeSlider.test.tsx`

### テストケース一覧

| #   | カテゴリ         | テストケース                               | 期待結果                      |
| --- | ---------------- | ------------------------------------------ | ----------------------------- |
| 1   | 表示             | ラベルが表示される                         | 「挽き目」テキスト表示        |
| 2   | 表示             | カスタムラベルが表示される                 | 指定したラベル表示            |
| 3   | 表示             | スライダーが表示される                     | slider role要素存在           |
| 4   | 表示             | スライダーの範囲が1〜10に設定されている    | min="1", max="10"             |
| 5   | 表示             | スライダーのステップが0.5に設定されている  | step="0.5"                    |
| 6   | 表示             | 整数の目盛り（1〜10）に数字が表示される    | 1〜10の数字がすべて表示       |
| 7   | 表示             | 「細挽き」と「粗挽き」のラベルが表示される | 両端のラベルが表示            |
| 8   | 表示             | 値が未設定の場合「未設定」が表示される     | 「未設定」テキスト表示        |
| 9   | 表示             | 値が設定されている場合、その値が表示される | 数値が表示（例: 5.5）         |
| 10  | 表示             | 値が設定されている場合、クリアボタン表示   | クリアボタン表示              |
| 11  | 表示             | 値が未設定の場合、クリアボタン非表示       | クリアボタンなし              |
| 12  | 目盛り表示       | 整数目盛りが長く表示される（h-3クラス）    | 10個の長い目盛り線            |
| 13  | 目盛り表示       | 0.5目盛りが短く表示される（h-1.5クラス）   | 9個の短い目盛り線             |
| 14  | インタラクション | スライダーを動かすとonChangeが呼ばれる     | onChange(新しい値)            |
| 15  | インタラクション | スライダーの値を0.5刻みで変更できる        | 0.5刻みの値でonChange呼び出し |
| 16  | インタラクション | クリアボタンをクリックすると値がnullになる | onChange(null)                |
| 17  | インタラクション | 外部から値が変更されると表示が更新される   | 新しい値が表示される          |
| 18  | フォーム連携     | hidden inputにname属性が設定される         | name="grindSize"              |
| 19  | フォーム連携     | hidden inputに現在の値が設定される         | value="5.5"                   |
| 20  | フォーム連携     | 値がnullの場合、hidden inputの値は空文字   | value=""                      |
| 21  | アクセシビリティ | スライダーにキーボードでアクセスできる     | disabled属性なし              |
| 22  | アクセシビリティ | クリアボタンがbutton要素である             | tagName=BUTTON, type="button" |
| 23  | 境界値           | 最小値1が正しく表示される                  | "1.0"表示                     |
| 24  | 境界値           | 最大値10が正しく表示される                 | "10.0"表示                    |
| 25  | 境界値           | 最小の0.5刻み値（1.5）が正しく動作する     | onChange(1.5)                 |
| 26  | 境界値           | 最大の0.5刻み値（9.5）が正しく動作する     | onChange(9.5)                 |

### 設計ポイント

- **目盛りの差別化**: 整数（1, 2, 3...）は長い目盛り＋数字表示、0.5刻み（1.5, 2.5...）は短い目盛りのみ
- **値の管理**: 内部State + hidden inputでフォーム連携
- **クリア機能**: クリアボタンでnull値に戻せる
- **ラベル**: 両端に「細挽き」「粗挽き」を表示

---

## BeanMaster API テスト

**ファイル:** `src/__tests__/api/beanMasters.test.ts`

### テストケース一覧

| #   | カテゴリ                      | テストケース                                     | 期待結果                       |
| --- | ----------------------------- | ------------------------------------------------ | ------------------------------ |
| 1   | GET /api/bean-masters         | 空の配列を返す（銘柄マスターが存在しない場合）   | 200 + `[]`                     |
| 2   | GET /api/bean-masters         | 全ての銘柄マスターを返す                         | 200 + 銘柄マスター配列         |
| 3   | GET /api/bean-masters         | 名前順（昇順）でソートされる                     | 200 + ABC順                    |
| 4   | POST /api/bean-masters        | 新しい銘柄マスターを作成する                     | 201 + 作成データ               |
| 5   | POST /api/bean-masters        | 名前のみで作成できる（任意フィールドは省略可）   | 201 + 作成データ（任意はnull） |
| 6   | POST /api/bean-masters        | 名前が空の場合は400エラー                        | 400 + エラーメッセージ         |
| 7   | POST /api/bean-masters        | 名前がない場合は400エラー                        | 400 + エラーメッセージ         |
| 8   | POST /api/bean-masters        | 無効な焙煎度の場合は400エラー                    | 400 + エラーメッセージ         |
| 9   | POST /api/bean-masters        | 無効な精製方法の場合は400エラー                  | 400 + エラーメッセージ         |
| 10  | GET /api/bean-masters/[id]    | 指定したIDの銘柄マスターを返す                   | 200 + 銘柄マスターデータ       |
| 11  | GET /api/bean-masters/[id]    | 紐づく豆の数（\_count.coffeeBeans）を含む        | 200 + \_count含む              |
| 12  | GET /api/bean-masters/[id]    | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ         |
| 13  | GET /api/bean-masters/[id]    | 無効なIDの場合は400エラー                        | 400 + エラーメッセージ         |
| 14  | PUT /api/bean-masters/[id]    | 銘柄マスターを更新する                           | 200 + 更新データ               |
| 15  | PUT /api/bean-masters/[id]    | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ         |
| 16  | PUT /api/bean-masters/[id]    | 名前を空に更新しようとすると400エラー            | 400 + エラーメッセージ         |
| 17  | DELETE /api/bean-masters/[id] | 銘柄マスターを削除する（豆が紐づいていない場合） | 204 + DBから削除確認           |
| 18  | DELETE /api/bean-masters/[id] | 豆が紐づいている場合は削除不可                   | 400 + エラーメッセージ         |
| 19  | DELETE /api/bean-masters/[id] | 存在しないIDの場合は404エラー                    | 404 + エラーメッセージ         |

### CoffeeBean API との連携テスト

**ファイル:** `src/__tests__/api/beans.test.ts`（銘柄マスター関連テストを追加）

| #   | カテゴリ        | テストケース                                       | 期待結果                              |
| --- | --------------- | -------------------------------------------------- | ------------------------------------- |
| 29  | POST /api/beans | beanMasterIdを指定して豆を作成できる               | 201 + beanMasterId含む                |
| 30  | POST /api/beans | 銘柄マスターの値（name, origin等）が自動補完される | 201 + 銘柄マスターの値で補完          |
| 31  | POST /api/beans | 存在しないbeanMasterIdの場合は400エラー            | 400 + エラーメッセージ                |
| 32  | GET /api/beans  | beanMasterIdでフィルタリングできる                 | 200 + フィルタリングされた配列        |
| 33  | GET /api/beans  | レスポンスにbeanMaster情報を含む                   | 200 + beanMaster含む（include: true） |

### テスト設計方針

1. **正常系**: 基本的なCRUD操作が正しく動作すること
2. **異常系（バリデーション）**: 不正な入力に対して適切なエラーを返すこと
3. **異常系（存在しないリソース）**: 存在しないIDへのアクセスで404を返すこと
4. **参照整合性**: 豆が紐づいている銘柄マスターの削除を防止
5. **自動補完**: 銘柄マスター指定時のフィールド自動補完が正しく動作すること

---

## Origin API テスト（産地マスター）

**ファイル:** `src/__tests__/api/origins.test.ts`

### テストケース一覧

| #   | カテゴリ                 | テストケース                 | 期待結果                       |
| --- | ------------------------ | ---------------------------- | ------------------------------ |
| 1   | GET /api/origins         | 空の一覧を取得できる         | 200 + `[]`                     |
| 2   | GET /api/origins         | 産地一覧を名前順で取得できる | 200 + 名前順でソートされた配列 |
| 3   | POST /api/origins        | 産地を作成できる             | 201 + 作成データ               |
| 4   | POST /api/origins        | メモ付きで産地を作成できる   | 201 + notes含む                |
| 5   | POST /api/origins        | 名前が空の場合はエラー       | 400 + エラーメッセージ         |
| 6   | POST /api/origins        | 名前が重複する場合はエラー   | 400 + エラーメッセージ         |
| 7   | GET /api/origins/[id]    | 産地詳細を取得できる         | 200 + 産地データ               |
| 8   | GET /api/origins/[id]    | 存在しないIDの場合は404      | 404 + エラーメッセージ         |
| 9   | GET /api/origins/[id]    | 無効なIDの場合は400          | 400 + エラーメッセージ         |
| 10  | PUT /api/origins/[id]    | 産地を更新できる             | 200 + 更新データ               |
| 11  | PUT /api/origins/[id]    | 存在しないIDの場合は404      | 404 + エラーメッセージ         |
| 12  | DELETE /api/origins/[id] | 産地を削除できる             | 204 + DBから削除確認           |
| 13  | DELETE /api/origins/[id] | 存在しないIDの場合は404      | 404 + エラーメッセージ         |

### テスト設計方針

1. **正常系**: 基本的なCRUD操作が正しく動作すること
2. **ソート**: 一覧取得時は名前順（あいうえお順）でソート
3. **ユニーク制約**: 同じ国名の重複登録を防止
4. **バリデーション**: 空文字の国名を拒否

---

## E2Eテスト（Playwright）

### 概要

Playwrightを使用したEnd-to-Endテストです。ブラウザ上での実際のユーザー操作をシミュレートします。

**テスト実行方法:**

```bash
# E2Eテスト実行
npx playwright test

# 特定のテストファイルを実行
npx playwright test tests/admin-origins.spec.ts

# ヘッドフルモードで実行（ブラウザが表示される）
npx playwright test --headed
```

### 産地マスター管理画面テスト

**ファイル:** `tests/admin-origins.spec.ts`

| #   | カテゴリ   | テストケース                 | 期待結果                       |
| --- | ---------- | ---------------------------- | ------------------------------ |
| 1   | 一覧ページ | 一覧ページが表示される       | 見出し「産地マスター一覧」表示 |
| 2   | 一覧ページ | 新規登録ボタンが表示される   | 「新規登録」リンク表示         |
| 3   | 一覧ページ | 登録済みの産地が表示される   | 登録データが一覧に表示         |
| 4   | 新規登録   | 新規登録ページが表示される   | 見出し「産地を新規登録」表示   |
| 5   | 新規登録   | 産地名は必須入力             | required属性付き               |
| 6   | 新規登録   | 産地を登録できる             | 登録成功→一覧へリダイレクト    |
| 7   | 新規登録   | 重複する産地名は登録できない | エラーメッセージ表示           |
| 8   | 詳細ページ | 詳細ページが表示される       | 産地名、メモが表示             |
| 9   | 詳細ページ | 編集ボタンがある             | 「編集」リンク表示             |
| 10  | 詳細ページ | 削除ボタンがある             | 「削除」ボタン表示             |
| 11  | 編集ページ | 編集ページが表示される       | 既存データがフォームに設定     |
| 12  | 編集ページ | 産地を更新できる             | 更新成功→詳細へリダイレクト    |
| 13  | 削除       | 産地を削除できる             | 削除成功→一覧へリダイレクト    |

### テスト設計方針

1. **ユニーク名生成**: 並列実行時のデータ競合を防ぐため、テストごとにユニークな名前を使用
2. **マルチブラウザ**: chromiumとMobile Chromeで同時実行
3. **レスポンシブ対応**: モバイル/デスクトップ両方でのUI動作を確認

---
